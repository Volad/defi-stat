server {
  listen 80;
  server_name _;

  # Root directory where Angular build artifacts are located.
  # Make sure this points exactly to the folder containing index.html
  root /usr/share/nginx/html/defi-frontend;


  # Proxy all API calls directly to backend service instead of SPA fallback.
  location /api/ {
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # "backend" here must match the docker-compose service name of the backend.
    proxy_pass http://backend:8080;
  }

  # Do not send /.well-known paths to Angular SPA, just serve them as is or return 404.
  location ^~ /.well-known/ {
    try_files $uri =404;
  }

  # SPA fallback: if file is not found, serve Angular's index.html
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Explicitly handle index.html to avoid rewrite loops
  location = /index.html {
    try_files /index.html =404;
  }

  # Increase upload size if needed
  client_max_body_size 10m;

  # Enable sendfile for better performance
  sendfile on;
}